<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <title>Curtain Animation</title>
  </head>
  <body>
    <div class="loader">
      <div class="overlay">
        <div class="block"></div>
        <div class="block"></div>
      </div>

      <div class="logo">
        <div class="word" id="word1">
          <h1><span>Marvel</span></h1>
        </div>
        <div class="word" id="word2">
          <h1>Studios</h1>
        </div>
      </div>

      <div class="divider"></div>

      <div class="spinner-container">
        <div class="spinner"></div>
      </div>

      <div class="counter">
        <div class="count">
          <div class="digit"><h1>0</h1></div>
          <div class="digit"><h1>0</h1></div>
        </div>
        <div class="count">
          <div class="digit"><h1>2</h1></div>
          <div class="digit"><h1>7</h1></div>
        </div>
        <div class="count">
          <div class="digit"><h1>6</h1></div>
          <div class="digit"><h1>8</h1></div>
        </div>
        <div class="count">
          <div class="digit"><h1>9</h1></div>
          <div class="digit"><h1>8</h1></div>
        </div>
        <div class="count">
          <div class="digit"><h1>9</h1></div>
          <div class="digit"><h1>9</h1></div>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="hero">
        <img src="./hero.jpg" alt="Hero Image" />
      </div>
    </div>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/CustomEase.min.js"></script>
  <script>
    gsap.registerPlugin(CustomEase);
    CustomEase.create("hop", "0.9, 0, 0.1, 1");

    document.addEventListener("DOMContentLoaded", () => {
      // --- Performance: Cache all DOM element selectors at the start ---
      const counts = document.querySelectorAll(".count");
      const spinner = ".spinner";
      const words = ".word h1";
      const word1 = "#word1 h1";
      const word2 = "#word2 h1";
      const divider = ".divider";
      const blocks = ".block";
      const hero = ".hero";

      // --- Readability: Create a master timeline for all animations ---
      const tl = gsap.timeline({
        delay: 0.3,
        defaults: {
          ease: "hop",
          duration: 1, // Set a default duration for cleaner tweens
        },
      });

      // --- Refined Logic: Animate the counter ---
      // The loop now directly adds tweens to the timeline at specific time marks.
      // The redundant `if` condition has been removed.
      counts.forEach((count, index) => {
        const digits = count.querySelectorAll(".digit h1");
        const startTime = index * 1; // Calculate start time for clarity

        // Animate digits into view
        tl.to(digits, { y: "0%", stagger: 0.075 }, startTime);
        // Animate digits out of view
        tl.to(digits, { y: "-110%", stagger: 0.075 }, startTime + 1);
      });

      // --- Chaining & Readability: Sequence the rest of the animations ---
      // Instead of using onComplete/onStart callbacks, we chain animations
      // directly on the timeline for better control and clarity.
      tl
        // Hide spinner and show words simultaneously
        .to(spinner, { opacity: 0, duration: 0.3 })
        .to(words, { y: "0%" }, "<") // '<' starts this tween with the previous one

        // Animate the divider line and its fade out
        .to(divider, { scaleY: "100%" })
        .to(divider, { opacity: 0, duration: 0.4, delay: 0.3 }) // Formerly an onComplete callback

        // Animate the words splitting apart
        .to(word1, { y: "200%", delay: 0.3 })
        .to(word2, { y: "-200%" }, "<")

        // Animate the curtain reveal and scale the hero image
        .to(blocks, {
          clipPath: "polygon(0% 0%, 100% 0%, 100% 0%, 0% 0%)",
          stagger: 0.1,
        })
        .to(hero, { scale: 1, duration: 2, ease: "hop" }, "<"); // Formerly an onStart callback
    });
  </script>
</html>